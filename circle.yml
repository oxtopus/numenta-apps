general:
  branches:
    only:
      - DEVOPS-53-circleci
machine:
  environment:
    PYTHONPATH: /home/ubuntu/local/lib/python2.7/site-packages
    CC: clang
    CXX: clang++
dependencies:
  pre:
    - sudo update-alternatives --install /usr/bin/cc clang /usr/bin/clang 20
    - sudo update-alternatives --install /usr/bin/c++ clang++ /usr/bin/clang++ 20
    - curl -O https://capnproto.org/capnproto-c++-0.5.3.tar.gz
    - tar zxf capnproto-c++-0.5.3.tar.gz
    - (cd capnproto-c++-0.5.3 && ./configure && make check && sudo make install)
    - mkdir -p ~/local/lib/python2.7/site-packages
    - (cd nta.utils && python setup.py install --prefix=/home/ubuntu/local)
    - (cd htmengine && python setup.py install --prefix=/home/ubuntu/local)
    - (cd infrastructure && python setup.py install --prefix=/home/ubuntu/local)
    - (cd taurus.metric_collectors && python setup.py install --prefix=/home/ubuntu/local)
    - (cd taurus && python setup.py install --prefix=/home/ubuntu/local)
